<!-- Calendarul -->
<div class="calendar-container">
  <div class="calendar-header">
    <h2>ğŸ“ RezervÄƒri Ping-Pong</h2>
    <div class="controls">
      <label for="duration">DuratÄƒ:</label>
      <select [(ngModel)]="selectedDuration">
        <option *ngFor="let d of durations" [value]="d">{{ d }} minute</option>
      </select>
    </div>
  </div>

  <div class="calendar-body">
    <div class="time-column">
      <div *ngFor="let hour of hours" class="hour">{{ hour }}</div>
    </div>
    <div class="grid-column" (click)="openModal(getHourFromOffset($event.offsetY))" (mousemove)="handleHover($event)"
      (mouseleave)="hoverVisible = false">

      <div *ngIf="hoverVisible" class="hover-block" [style.top.px]="hoverTop" [style.height.px]="selectedDuration">
      </div>
      <div *ngIf="hoverVisible" class="hover-tooltip" [style.top.px]="hoverTop" style="left: 120px;">
        {{ hoverStart }} - {{ hoverEnd }}
      </div>

      <div class="reservations">
        <div *ngFor="let block of blocks" class="event" [style.top.px]="block.top" [style.height.px]="block.height"
          [ngClass]="{ 'mine': block.mine }" (click)="openDetails(block, $event)">
          {{ block.mine ? 'Tu' : block.user }}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Toast -->
<div class="toast" *ngIf="showToast">
  âœ… Rezervarea a fost efectuatÄƒ cu succes!
</div>

<!-- Modal rezervare nouÄƒ -->
<div class="modal-overlay" *ngIf="modalVisible">
  <div class="modal-box">
    <h3>Confirmare rezervare</h3>
    <p>Rezervi Ã®ntre <strong>{{ modalStart }}</strong> È™i <strong>{{ modalEnd }}</strong>?</p>
    <p><strong>Utilizator:</strong> {{ currentUserName || 'Tu' }}</p>
    <div class="modal-actions">
      <button class="btn confirm" (click)="confirmReservation()">ConfirmÄƒ</button>
      <button class="btn cancel" (click)="closeModal()">AnuleazÄƒ</button>
    </div>
  </div>
</div>

<!-- Modal detalii rezervare -->
<!-- Modal detalii rezervare -->
<div class="modal-overlay" *ngIf="reservationDetailsVisible">
  <div class="modal-box">
    <h3>Detalii rezervare</h3>
    <p><strong>Utilizator:</strong> {{ selectedReservation?.user }}</p>
    <p><strong>DatÄƒ:</strong> {{ formatDate(selectedReservation?.date || '') }}</p>
    <p><strong>Interval:</strong> {{ selectedReservation?.start }} â€“ {{ selectedReservation?.end }}</p>

    <!-- DacÄƒ este creatorul rezervÄƒrii -->
    <div *ngIf="selectedReservation?.mine && !isMaxGuestsReached">
      <label for="guest">InvitÄƒ coleg:</label>
      <select [(ngModel)]="invitedUserId">
        <ng-container *ngFor="let u of users">
          <option *ngIf="!isUserAlreadyInvited(u.email)" [value]="u.id">
            {{ u.name }} ({{ u.email }})
          </option>
        </ng-container>
      </select>
    </div>

    <!-- Mesaj cÄƒ ai atins limita -->
    <p *ngIf="selectedReservation?.mine && isMaxGuestsReached" class="limit-warning">
      âŒ LimitÄƒ atinsÄƒ: maxim 3 invitaÈ›i.
    </p>

    <!-- AfiÈ™are invitaÈ›i existenÈ›i -->
    <div *ngIf="selectedReservation?.guests?.length">
      <h4>InvitaÈ›i:</h4>
      <ul>
        <li *ngFor="let guest of selectedReservation?.guests ?? []">
          {{ guest.name }} ({{ guest.email }}) -
          <span class="guest-status {{ guest.status }}">{{ guest.status }}</span>
        </li>
      </ul>
    </div>


    <div class="modal-actions">
      <button class="btn confirm" (click)="inviteGuest()" [disabled]="isMaxGuestsReached">
        InvitÄƒ
      </button>

      <button class="btn cancel" (click)="reservationDetailsVisible = false">Ãnchide</button>
    </div>
  </div>
</div>